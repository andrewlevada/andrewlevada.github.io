var B=/[$_\p{ID_Start}]/u,V=/[$_\u200C\u200D\p{ID_Continue}]/u;function Z(e,t){return(t?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(e)}function v(e,t=!1){const n=[];let r=0;for(;r<e.length;){const o=e[r],c=function(h){if(!t)throw new TypeError(h);n.push({type:"INVALID_CHAR",index:r,value:e[r++]})};if(o==="*"){n.push({type:"ASTERISK",index:r,value:e[r++]});continue}if(o==="+"||o==="?"){n.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(o==="\\"){n.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(o==="{"){n.push({type:"OPEN",index:r,value:e[r++]});continue}if(o==="}"){n.push({type:"CLOSE",index:r,value:e[r++]});continue}if(o===":"){let h="",s=r+1;for(;s<e.length;){const i=e.substr(s,1);if(s===r+1&&B.test(i)||s!==r+1&&V.test(i)){h+=e[s++];continue}break}if(!h){c(`Missing parameter name at ${r}`);continue}n.push({type:"NAME",index:r,value:h}),r=s;continue}if(o==="("){let h=1,s="",i=r+1,f=!1;if(e[i]==="?"){c(`Pattern cannot start with "?" at ${i}`);continue}for(;i<e.length;){if(!Z(e[i],!1)){c(`Invalid character '${e[i]}' at ${i}.`),f=!0;break}if(e[i]==="\\"){s+=e[i++]+e[i++];continue}if(e[i]===")"){if(h--,h===0){i++;break}}else if(e[i]==="("&&(h++,e[i+1]!=="?")){c(`Capturing groups are not allowed at ${i}`),f=!0;break}s+=e[i++]}if(f)continue;if(h){c(`Unbalanced pattern at ${r}`);continue}if(!s){c(`Missing pattern at ${r}`);continue}n.push({type:"PATTERN",index:r,value:s}),r=i;continue}n.push({type:"CHAR",index:r,value:e[r++]})}return n.push({type:"END",index:r,value:""}),n}function L(e,t={}){const n=v(e),{prefixes:r="./"}=t,o=`[^${b(t.delimiter===void 0?"/#?":t.delimiter)}]+?`,c=[];let h=0,s=0,i="",f=new Set;const a=l=>{if(s<n.length&&n[s].type===l)return n[s++].value},p=()=>{const l=a("MODIFIER");return l||a("ASTERISK")},u=l=>{const m=a(l);if(m!==void 0)return m;const{type:y,index:C}=n[s];throw new TypeError(`Unexpected ${y} at ${C}, expected ${l}`)},g=()=>{let l="",m;for(;m=a("CHAR")||a("ESCAPED_CHAR");)l+=m;return l},G=l=>l,P=t.encodePart||G;for(;s<n.length;){const l=a("CHAR"),m=a("NAME");let y=a("PATTERN");if(!m&&!y&&a("ASTERISK")&&(y=".*"),m||y){let x=l||"";r.indexOf(x)===-1&&(i+=x,x=""),i&&(c.push(P(i)),i="");const d=m||h++;if(f.has(d))throw new TypeError(`Duplicate name '${d}'.`);f.add(d),c.push({name:d,prefix:P(x),suffix:"",pattern:y||o,modifier:p()||""});continue}const C=l||a("ESCAPED_CHAR");if(C){i+=C;continue}if(a("OPEN")){const x=g(),d=a("NAME")||"";let w=a("PATTERN")||"";!d&&!w&&a("ASTERISK")&&(w=".*");const K=g();u("CLOSE");const T=p()||"";if(!d&&!w&&!T){i+=x;continue}if(!d&&!w&&!x)continue;i&&(c.push(P(i)),i=""),c.push({name:d||(w?h++:""),pattern:d&&!w?o:w,prefix:P(x),suffix:P(K),modifier:T});continue}i&&(c.push(P(i)),i=""),u("END")}return c}function b(e){return e.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function N(e){return e&&e.ignoreCase?"ui":"u"}function q(e,t){if(!t)return e;const n=/\((?:\?<(.*?)>)?(?!\?)/g;let r=0,o=n.exec(e.source);for(;o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}function J(e,t,n){const r=e.map(o=>O(o,t,n).source);return new RegExp(`(?:${r.join("|")})`,N(n))}function Q(e,t,n){return U(L(e,n),t,n)}function U(e,t,n={}){const{strict:r=!1,start:o=!0,end:c=!0,encode:h=a=>a}=n,s=`[${b(n.endsWith===void 0?"":n.endsWith)}]|$`,i=`[${b(n.delimiter===void 0?"/#?":n.delimiter)}]`;let f=o?"^":"";for(const a of e)if(typeof a=="string")f+=b(h(a));else{const p=b(h(a.prefix)),u=b(h(a.suffix));if(a.pattern)if(t&&t.push(a),p||u)if(a.modifier==="+"||a.modifier==="*"){const g=a.modifier==="*"?"?":"";f+=`(?:${p}((?:${a.pattern})(?:${u}${p}(?:${a.pattern}))*)${u})${g}`}else f+=`(?:${p}(${a.pattern})${u})${a.modifier}`;else a.modifier==="+"||a.modifier==="*"?f+=`((?:${a.pattern})${a.modifier})`:f+=`(${a.pattern})${a.modifier}`;else f+=`(?:${p}${u})${a.modifier}`}if(c)r||(f+=`${i}?`),f+=n.endsWith?`(?=${s})`:"$";else{const a=e[e.length-1],p=typeof a=="string"?i.indexOf(a[a.length-1])>-1:a===void 0;r||(f+=`(?:${i}(?=${s}))?`),p||(f+=`(?=${i}|${s})`)}return new RegExp(f,N(n))}function O(e,t,n){return e instanceof RegExp?q(e,t):Array.isArray(e)?J(e,t,n):Q(e,t,n)}var k={delimiter:"",prefixes:"",sensitive:!0,strict:!0},X={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Y={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function ee(e,t){return e.length?e[0]==="/"?!0:!t||e.length<2?!1:(e[0]=="\\"||e[0]=="{")&&e[1]=="/":!1}function D(e,t){return e.startsWith(t)?e.substring(t.length,e.length):e}function te(e,t){return e.endsWith(t)?e.substr(0,e.length-t.length):e}function _(e){return!e||e.length<2?!1:e[0]==="["||(e[0]==="\\"||e[0]==="{")&&e[1]==="["}var H=["ftp","file","http","https","ws","wss"];function j(e){if(!e)return!0;for(const t of H)if(e.test(t))return!0;return!1}function ne(e,t){if(e=D(e,"#"),t||e==="")return e;const n=new URL("https://example.com");return n.hash=e,n.hash?n.hash.substring(1,n.hash.length):""}function re(e,t){if(e=D(e,"?"),t||e==="")return e;const n=new URL("https://example.com");return n.search=e,n.search?n.search.substring(1,n.search.length):""}function se(e,t){return t||e===""?e:_(e)?z(e):F(e)}function ie(e,t){if(t||e==="")return e;const n=new URL("https://example.com");return n.password=e,n.password}function ae(e,t){if(t||e==="")return e;const n=new URL("https://example.com");return n.username=e,n.username}function oe(e,t,n){if(n||e==="")return e;if(t&&!H.includes(t))return new URL(`${t}:${e}`).pathname;const r=e[0]=="/";return e=new URL(r?e:"/-"+e,"https://example.com").pathname,r||(e=e.substring(2,e.length)),e}function he(e,t,n){return M(t)===e&&(e=""),n||e===""?e:W(e)}function ce(e,t){return e=te(e,":"),t||e===""?e:$(e)}function M(e){switch(e){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function $(e){if(e==="")return e;if(/^[-+.A-Za-z0-9]*$/.test(e))return e.toLowerCase();throw new TypeError(`Invalid protocol '${e}'.`)}function fe(e){if(e==="")return e;const t=new URL("https://example.com");return t.username=e,t.username}function ue(e){if(e==="")return e;const t=new URL("https://example.com");return t.password=e,t.password}function F(e){if(e==="")return e;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(e))throw new TypeError(`Invalid hostname '${e}'`);const t=new URL("https://example.com");return t.hostname=e,t.hostname}function z(e){if(e==="")return e;if(/[^0-9a-fA-F[\]:]/g.test(e))throw new TypeError(`Invalid IPv6 hostname '${e}'`);return e.toLowerCase()}function W(e){if(e===""||/^[0-9]*$/.test(e)&&parseInt(e)<=65535)return e;throw new TypeError(`Invalid port '${e}'.`)}function le(e){if(e==="")return e;const t=new URL("https://example.com");return t.pathname=e[0]!=="/"?"/-"+e:e,e[0]!=="/"?t.pathname.substring(2,t.pathname.length):t.pathname}function pe(e){return e===""?e:new URL(`data:${e}`).pathname}function de(e){if(e==="")return e;const t=new URL("https://example.com");return t.search=e,t.search.substring(1,t.search.length)}function me(e){if(e==="")return e;const t=new URL("https://example.com");return t.hash=e,t.hash.substring(1,t.hash.length)}var ge=class{constructor(e){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=e}get result(){return this.internalResult}parse(){for(this.tokenList=v(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let e=7,t=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(e=2,t=3):this.shouldTreatAsStandardURL&&(e=2),this.changeState(e,t)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break}}}changeState(e,t){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break}this.changeStateWithoutSettingComponent(e,t)}changeStateWithoutSettingComponent(e,t){this.state=e,this.componentStart=this.tokenIndex+t,this.tokenIndex+=t,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(e){this.rewind(),this.state=e}safeToken(e){return e<0&&(e=this.tokenList.length-e),e<this.tokenList.length?this.tokenList[e]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(e,t){const n=this.safeToken(e);return n.value===t&&(n.type==="CHAR"||n.type==="ESCAPED_CHAR"||n.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;const e=this.safeToken(this.tokenIndex-1);return e.type!=="NAME"&&e.type!=="PATTERN"&&e.type!=="CLOSE"&&e.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){const e=this.tokenList[this.tokenIndex],t=this.safeToken(this.componentStart).index;return this.input.substring(t,e.index)}computeShouldTreatAsStandardURL(){const e={};Object.assign(e,k),e.encodePart=$;const t=O(this.makeComponentString(),void 0,e);this.shouldTreatAsStandardURL=j(t)}},E=["protocol","username","password","hostname","port","pathname","search","hash"],S="*";function A(e,t){if(typeof e!="string")throw new TypeError("parameter 1 is not of type 'string'.");const n=new URL(e,t);return{protocol:n.protocol.substring(0,n.protocol.length-1),username:n.username,password:n.password,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search!=""?n.search.substring(1,n.search.length):void 0,hash:n.hash!=""?n.hash.substring(1,n.hash.length):void 0}}function R(e,t,n){let r;if(typeof t.baseURL=="string")try{r=new URL(t.baseURL),e.protocol=r.protocol?r.protocol.substring(0,r.protocol.length-1):"",e.username=r.username,e.password=r.password,e.hostname=r.hostname,e.port=r.port,e.pathname=r.pathname,e.search=r.search?r.search.substring(1,r.search.length):"",e.hash=r.hash?r.hash.substring(1,r.hash.length):""}catch{throw new TypeError(`invalid baseURL '${t.baseURL}'.`)}if(typeof t.protocol=="string"&&(e.protocol=ce(t.protocol,n)),typeof t.username=="string"&&(e.username=ae(t.username,n)),typeof t.password=="string"&&(e.password=ie(t.password,n)),typeof t.hostname=="string"&&(e.hostname=se(t.hostname,n)),typeof t.port=="string"&&(e.port=he(t.port,e.protocol,n)),typeof t.pathname=="string"){if(e.pathname=t.pathname,r&&!ee(e.pathname,n)){const o=r.pathname.lastIndexOf("/");o>=0&&(e.pathname=r.pathname.substring(0,o+1)+e.pathname)}e.pathname=oe(e.pathname,e.protocol,n)}return typeof t.search=="string"&&(e.search=re(t.search,n)),typeof t.hash=="string"&&(e.hash=ne(t.hash,n)),e}function I(e){return e.replace(/([+*?:{}()\\])/g,"\\$1")}function xe(e){return e.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Se(e,t){const n=".*",r=`[^${xe(t.delimiter===void 0?"/#?":t.delimiter)}]+?`,o=/[$_\u200C\u200D\p{ID_Continue}]/u;let c="";for(let h=0;h<e.length;++h){const s=e[h],i=h>0?e[h-1]:null,f=h<e.length-1?e[h+1]:null;if(typeof s=="string"){c+=I(s);continue}if(s.pattern===""){if(s.modifier===""){c+=I(s.prefix);continue}c+=`{${I(s.prefix)}}${s.modifier}`;continue}const a=typeof s.name!="number",p=t.prefixes!==void 0?t.prefixes:"./";let u=s.suffix!==""||s.prefix!==""&&(s.prefix.length!==1||!p.includes(s.prefix));if(!u&&a&&s.pattern===r&&s.modifier===""&&f&&!f.prefix&&!f.suffix)if(typeof f=="string"){const g=f.length>0?f[0]:"";u=o.test(g)}else u=typeof f.name=="number";if(!u&&s.prefix===""&&i&&typeof i=="string"&&i.length>0){const g=i[i.length-1];u=p.includes(g)}u&&(c+="{"),c+=I(s.prefix),a&&(c+=`:${s.name}`),s.pattern===n?!a&&(!i||typeof i=="string"||i.modifier||u||s.prefix!=="")?c+="*":c+=`(${n})`:s.pattern===r?a||(c+=`(${r})`):c+=`(${s.pattern})`,s.pattern===r&&a&&s.suffix!==""&&o.test(s.suffix[0])&&(c+="\\"),c+=I(s.suffix),u&&(c+="}"),c+=s.modifier}return c}var ke=class{constructor(e={},t,n){this.regexp={},this.keys={},this.component_pattern={};try{let r;if(typeof t=="string"?r=t:n=t,typeof e=="string"){const s=new ge(e);if(s.parse(),e=s.result,r===void 0&&typeof e.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.");e.baseURL=r}else{if(!e||typeof e!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");if(r)throw new TypeError("parameter 1 is not of type 'string'.")}typeof n>"u"&&(n={ignoreCase:!1});const o={ignoreCase:n.ignoreCase===!0},c={pathname:S,protocol:S,username:S,password:S,hostname:S,port:S,search:S,hash:S};this.pattern=R(c,e,!0),M(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let h;for(h of E){if(!(h in this.pattern))continue;const s={},i=this.pattern[h];switch(this.keys[h]=[],h){case"protocol":Object.assign(s,k),s.encodePart=$;break;case"username":Object.assign(s,k),s.encodePart=fe;break;case"password":Object.assign(s,k),s.encodePart=ue;break;case"hostname":Object.assign(s,X),_(i)?s.encodePart=z:s.encodePart=F;break;case"port":Object.assign(s,k),s.encodePart=W;break;case"pathname":j(this.regexp.protocol)?(Object.assign(s,Y,o),s.encodePart=le):(Object.assign(s,k,o),s.encodePart=pe);break;case"search":Object.assign(s,k,o),s.encodePart=de;break;case"hash":Object.assign(s,k,o),s.encodePart=me;break}try{const f=L(i,s);this.regexp[h]=U(f,this.keys[h],s),this.component_pattern[h]=Se(f,s)}catch{throw new TypeError(`invalid ${h} pattern '${this.pattern[h]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(e={},t){let n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof e!="string"&&t)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof e>"u")return!1;try{typeof e=="object"?n=R(n,e,!1):n=R(n,A(e,t),!1)}catch{return!1}let r;for(r of E)if(!this.regexp[r].exec(n[r]))return!1;return!0}exec(e={},t){let n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof e!="string"&&t)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof e>"u")return;try{typeof e=="object"?n=R(n,e,!1):n=R(n,A(e,t),!1)}catch{return null}let r={};t?r.inputs=[e,t]:r.inputs=[e];let o;for(o of E){let c=this.regexp[o].exec(n[o]);if(!c)return null;let h={};for(let[s,i]of this.keys[o].entries())if(typeof i.name=="string"||typeof i.name=="number"){let f=c[s+1];h[i.name]=f}r[o]={input:n[o]||"",groups:h}}return r}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=ke);export{ke as URLPattern};
