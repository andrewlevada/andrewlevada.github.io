var V=/[$_\p{ID_Start}]/u,z=/[$_\u200C\u200D\p{ID_Continue}]/u;function Z(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function A(t,e=!1){const n=[];let r=0;for(;r<t.length;){const h=t[r],p=function(o){if(!e)throw new TypeError(o);n.push({type:"INVALID_CHAR",index:r,value:t[r++]})};if(h==="*"){n.push({type:"ASTERISK",index:r,value:t[r++]});continue}if(h==="+"||h==="?"){n.push({type:"MODIFIER",index:r,value:t[r++]});continue}if(h==="\\"){n.push({type:"ESCAPED_CHAR",index:r++,value:t[r++]});continue}if(h==="{"){n.push({type:"OPEN",index:r,value:t[r++]});continue}if(h==="}"){n.push({type:"CLOSE",index:r,value:t[r++]});continue}if(h===":"){let o="",s=r+1;for(;s<t.length;){const i=t.substr(s,1);if(s===r+1&&V.test(i)||s!==r+1&&z.test(i)){o+=t[s++];continue}break}if(!o){p(`Missing parameter name at ${r}`);continue}n.push({type:"NAME",index:r,value:o}),r=s;continue}if(h==="("){let o=1,s="",i=r+1,c=!1;if(t[i]==="?"){p(`Pattern cannot start with "?" at ${i}`);continue}for(;i<t.length;){if(!Z(t[i],!1)){p(`Invalid character '${t[i]}' at ${i}.`),c=!0;break}if(t[i]==="\\"){s+=t[i++]+t[i++];continue}if(t[i]===")"){if(o--,o===0){i++;break}}else if(t[i]==="("&&(o++,t[i+1]!=="?")){p(`Capturing groups are not allowed at ${i}`),c=!0;break}s+=t[i++]}if(c)continue;if(o){p(`Unbalanced pattern at ${r}`);continue}if(!s){p(`Missing pattern at ${r}`);continue}n.push({type:"PATTERN",index:r,value:s}),r=i;continue}n.push({type:"CHAR",index:r,value:t[r++]})}return n.push({type:"END",index:r,value:""}),n}function T(t,e={}){const n=A(t),{prefixes:r="./"}=e,h=`[^${R(e.delimiter===void 0?"/#?":e.delimiter)}]+?`,p=[];let o=0,s=0,i="",c=new Set;const a=l=>{if(s<n.length&&n[s].type===l)return n[s++].value},f=()=>a("MODIFIER")||a("ASTERISK"),u=l=>{const d=a(l);if(d!==void 0)return d;const{type:P,index:I}=n[s];throw new TypeError(`Unexpected ${P} at ${I}, expected ${l}`)},g=()=>{let l="",d;for(;d=a("CHAR")||a("ESCAPED_CHAR");)l+=d;return l},B=l=>l,y=e.encodePart||B;for(;s<n.length;){const l=a("CHAR"),d=a("NAME");let P=a("PATTERN");if(!d&&!P&&a("ASTERISK")&&(P=".*"),d||P){let x=l||"";r.indexOf(x)===-1&&(i+=x,x=""),i&&(p.push(y(i)),i="");const m=d||o++;if(c.has(m))throw new TypeError(`Duplicate name '${m}'.`);c.add(m),p.push({name:m,prefix:y(x),suffix:"",pattern:P||h,modifier:f()||""});continue}const I=l||a("ESCAPED_CHAR");if(I){i+=I;continue}if(a("OPEN")){const x=g(),m=a("NAME")||"";let w=a("PATTERN")||"";!m&&!w&&a("ASTERISK")&&(w=".*");const G=g();u("CLOSE");const L=f()||"";if(!m&&!w&&!L){i+=x;continue}if(!m&&!w&&!x)continue;i&&(p.push(y(i)),i=""),p.push({name:m||(w?o++:""),pattern:m&&!w?h:w,prefix:y(x),suffix:y(G),modifier:L});continue}i&&(p.push(y(i)),i=""),u("END")}return p}function R(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function U(t){return t&&t.ignoreCase?"ui":"u"}function q(t,e){if(!e)return t;const n=/\((?:\?<(.*?)>)?(?!\?)/g;let r=0,h=n.exec(t.source);for(;h;)e.push({name:h[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),h=n.exec(t.source);return t}function J(t,e,n){const r=t.map(h=>O(h,e,n).source);return new RegExp(`(?:${r.join("|")})`,U(n))}function Q(t,e,n){return N(T(t,n),e,n)}function N(t,e,n={}){const{strict:r=!1,start:h=!0,end:p=!0,encode:o=a=>a}=n,s=`[${R(n.endsWith===void 0?"":n.endsWith)}]|$`,i=`[${R(n.delimiter===void 0?"/#?":n.delimiter)}]`;let c=h?"^":"";for(const a of t)if(typeof a=="string")c+=R(o(a));else{const f=R(o(a.prefix)),u=R(o(a.suffix));if(a.pattern)if(e&&e.push(a),f||u)if(a.modifier==="+"||a.modifier==="*"){const g=a.modifier==="*"?"?":"";c+=`(?:${f}((?:${a.pattern})(?:${u}${f}(?:${a.pattern}))*)${u})${g}`}else c+=`(?:${f}(${a.pattern})${u})${a.modifier}`;else a.modifier==="+"||a.modifier==="*"?c+=`((?:${a.pattern})${a.modifier})`:c+=`(${a.pattern})${a.modifier}`;else c+=`(?:${f}${u})${a.modifier}`}if(p)r||(c+=`${i}?`),c+=n.endsWith?`(?=${s})`:"$";else{const a=t[t.length-1],f=typeof a=="string"?i.indexOf(a[a.length-1])>-1:a===void 0;r||(c+=`(?:${i}(?=${s}))?`),f||(c+=`(?=${i}|${s})`)}return new RegExp(c,U(n))}function O(t,e,n){return t instanceof RegExp?q(t,e):Array.isArray(t)?J(t,e,n):Q(t,e,n)}var k={delimiter:"",prefixes:"",sensitive:!0,strict:!0},X={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Y={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function tt(t,e){return t.length?t[0]==="/"?!0:!e||t.length<2?!1:(t[0]=="\\"||t[0]=="{")&&t[1]=="/":!1}function D(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function et(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}function _(t){return!t||t.length<2?!1:t[0]==="["||(t[0]==="\\"||t[0]==="{")&&t[1]==="["}var H=["ftp","file","http","https","ws","wss"];function j(t){if(!t)return!0;for(const e of H)if(t.test(e))return!0;return!1}function nt(t,e){if(t=D(t,"#"),e||t==="")return t;const n=new URL("https://example.com");return n.hash=t,n.hash?n.hash.substring(1,n.hash.length):""}function rt(t,e){if(t=D(t,"?"),e||t==="")return t;const n=new URL("https://example.com");return n.search=t,n.search?n.search.substring(1,n.search.length):""}function st(t,e){return e||t===""?t:_(t)?W(t):F(t)}function it(t,e){if(e||t==="")return t;const n=new URL("https://example.com");return n.password=t,n.password}function at(t,e){if(e||t==="")return t;const n=new URL("https://example.com");return n.username=t,n.username}function ot(t,e,n){if(n||t==="")return t;if(e&&!H.includes(e))return new URL(`${e}:${t}`).pathname;const r=t[0]=="/";return t=new URL(r?t:"/-"+t,"https://example.com").pathname,r||(t=t.substring(2,t.length)),t}function ht(t,e,n){return M(e)===t&&(t=""),n||t===""?t:K(t)}function pt(t,e){return t=et(t,":"),e||t===""?t:E(t)}function M(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function E(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function ct(t){if(t==="")return t;const e=new URL("https://example.com");return e.username=t,e.username}function ut(t){if(t==="")return t;const e=new URL("https://example.com");return e.password=t,e.password}function F(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);const e=new URL("https://example.com");return e.hostname=t,e.hostname}function W(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function K(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function ft(t){if(t==="")return t;const e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function lt(t){return t===""?t:new URL(`data:${t}`).pathname}function mt(t){if(t==="")return t;const e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function dt(t){if(t==="")return t;const e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}var gt=class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=A(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break}}}changeState(t,e){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){const n=this.safeToken(t);return n.value===e&&(n.type==="CHAR"||n.type==="ESCAPED_CHAR"||n.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;const t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){const t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){const t={};Object.assign(t,k),t.encodePart=E;const e=O(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=j(e)}},C=["protocol","username","password","hostname","port","pathname","search","hash"],S="*";function v(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");const n=new URL(t,e);return{protocol:n.protocol.substring(0,n.protocol.length-1),username:n.username,password:n.password,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search!=""?n.search.substring(1,n.search.length):void 0,hash:n.hash!=""?n.hash.substring(1,n.hash.length):void 0}}function b(t,e,n){let r;if(typeof e.baseURL=="string")try{r=new URL(e.baseURL),t.protocol=r.protocol?r.protocol.substring(0,r.protocol.length-1):"",t.username=r.username,t.password=r.password,t.hostname=r.hostname,t.port=r.port,t.pathname=r.pathname,t.search=r.search?r.search.substring(1,r.search.length):"",t.hash=r.hash?r.hash.substring(1,r.hash.length):""}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(t.protocol=pt(e.protocol,n)),typeof e.username=="string"&&(t.username=at(e.username,n)),typeof e.password=="string"&&(t.password=it(e.password,n)),typeof e.hostname=="string"&&(t.hostname=st(e.hostname,n)),typeof e.port=="string"&&(t.port=ht(e.port,t.protocol,n)),typeof e.pathname=="string"){if(t.pathname=e.pathname,r&&!tt(t.pathname,n)){const h=r.pathname.lastIndexOf("/");h>=0&&(t.pathname=r.pathname.substring(0,h+1)+t.pathname)}t.pathname=ot(t.pathname,t.protocol,n)}return typeof e.search=="string"&&(t.search=rt(e.search,n)),typeof e.hash=="string"&&(t.hash=nt(e.hash,n)),t}function $(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function xt(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function St(t,e){const n=".*",r=`[^${xt(e.delimiter===void 0?"/#?":e.delimiter)}]+?`,h=/[$_\u200C\u200D\p{ID_Continue}]/u;let p="";for(let o=0;o<t.length;++o){const s=t[o],i=o>0?t[o-1]:null,c=o<t.length-1?t[o+1]:null;if(typeof s=="string"){p+=$(s);continue}if(s.pattern===""){if(s.modifier===""){p+=$(s.prefix);continue}p+=`{${$(s.prefix)}}${s.modifier}`;continue}const a=typeof s.name!="number",f=e.prefixes!==void 0?e.prefixes:"./";let u=s.suffix!==""||s.prefix!==""&&(s.prefix.length!==1||!f.includes(s.prefix));if(!u&&a&&s.pattern===r&&s.modifier===""&&c&&!c.prefix&&!c.suffix)if(typeof c=="string"){const g=c.length>0?c[0]:"";u=h.test(g)}else u=typeof c.name=="number";if(!u&&s.prefix===""&&i&&typeof i=="string"&&i.length>0){const g=i[i.length-1];u=f.includes(g)}u&&(p+="{"),p+=$(s.prefix),a&&(p+=`:${s.name}`),s.pattern===n?!a&&(!i||typeof i=="string"||i.modifier||u||s.prefix!=="")?p+="*":p+=`(${n})`:s.pattern===r?a||(p+=`(${r})`):p+=`(${s.pattern})`,s.pattern===r&&a&&s.suffix!==""&&h.test(s.suffix[0])&&(p+="\\"),p+=$(s.suffix),u&&(p+="}"),p+=s.modifier}return p}var kt=class{constructor(t={},e,n){this.regexp={},this.keys={},this.component_pattern={};try{let r;if(typeof e=="string"?r=e:n=e,typeof t=="string"){const s=new gt(t);if(s.parse(),t=s.result,r===void 0&&typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.");t.baseURL=r}else{if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");if(r)throw new TypeError("parameter 1 is not of type 'string'.")}typeof n>"u"&&(n={ignoreCase:!1});const h={ignoreCase:n.ignoreCase===!0},p={pathname:S,protocol:S,username:S,password:S,hostname:S,port:S,search:S,hash:S};this.pattern=b(p,t,!0),M(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let o;for(o of C){if(!(o in this.pattern))continue;const s={},i=this.pattern[o];switch(this.keys[o]=[],o){case"protocol":Object.assign(s,k),s.encodePart=E;break;case"username":Object.assign(s,k),s.encodePart=ct;break;case"password":Object.assign(s,k),s.encodePart=ut;break;case"hostname":Object.assign(s,X),_(i)?s.encodePart=W:s.encodePart=F;break;case"port":Object.assign(s,k),s.encodePart=K;break;case"pathname":j(this.regexp.protocol)?(Object.assign(s,Y,h),s.encodePart=ft):(Object.assign(s,k,h),s.encodePart=lt);break;case"search":Object.assign(s,k,h),s.encodePart=mt;break;case"hash":Object.assign(s,k,h),s.encodePart=dt;break}try{const c=T(i,s);this.regexp[o]=N(c,this.keys[o],s),this.component_pattern[o]=St(c,s)}catch{throw new TypeError(`invalid ${o} pattern '${this.pattern[o]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(t={},e){let n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return!1;try{typeof t=="object"?n=b(n,t,!1):n=b(n,v(t,e),!1)}catch{return!1}let r;for(r of C)if(!this.regexp[r].exec(n[r]))return!1;return!0}exec(t={},e){let n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return;try{typeof t=="object"?n=b(n,t,!1):n=b(n,v(t,e),!1)}catch{return null}let r={};e?r.inputs=[t,e]:r.inputs=[t];let h;for(h of C){let p=this.regexp[h].exec(n[h]);if(!p)return null;let o={};for(let[s,i]of this.keys[h].entries())if(typeof i.name=="string"||typeof i.name=="number"){let c=p[s+1];o[i.name]=c}r[h]={input:n[h]||"",groups:o}}return r}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=kt);export{kt as URLPattern};
